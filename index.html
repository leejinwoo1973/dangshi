<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ íƒ€ì„ë¼ì¸ DB (v8.0)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=KoPub+Batang:wght@400;700&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/pinyin-pro"></script>
    <style>
        /* [ì¤‘ìš”] ë ˆì´ì•„ì›ƒ ì˜¤ì°¨ ì œê±°ë¥¼ ìœ„í•œ ì„¤ì • */
        * { box-sizing: border-box; }

        /* --- 1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        :root { --line-color: #8B0000; --text-color: #333; --edit-color: #0056b3; --link-color: #1a0dab; --dot-color: #aaa; --tag-bg: #eef; --tag-text: #0044cc; }
        
        /* [í™•ì¸ìš©] ë°°ê²½ìƒ‰ì„ ì—°í•œ ë¶‰ì€ìƒ‰ìœ¼ë¡œ ë³€ê²½ (ì—…ë°ì´íŠ¸ í™•ì¸ìš©) */
        body { font-family: 'KoPub Batang', 'Noto Serif KR', serif; color: var(--text-color); margin: 0; padding: 0; background-color: #fff0f0; background-attachment: fixed; transition: background 0.3s; }
        
        /* --- ìƒë‹¨ ê³ ì • ì˜ì—­ (Sticky) --- */
        #stickyHeader {
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: #fff0f0; /* ë°°ê²½ìƒ‰ í†µì¼ */
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding-top: 20px;
            transition: background 0.3s;
        }

        header { text-align: center; margin-bottom: 10px; padding: 0 20px;}
        h1 { color: var(--line-color); word-break: keep-all; margin-bottom: 5px; text-shadow: 2px 2px 0px rgba(255,255,255,0.8); margin-top: 0;}
        .page-desc { color: #555; font-size: 0.95rem; margin-bottom: 15px; font-weight: bold; text-shadow: 1px 1px 0px rgba(255,255,255,0.8); }
        
        .search-bar { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .search-input { padding: 8px; border: 2px solid var(--line-color); border-radius: 20px; width: 250px; outline: none; }
        .filter-select { padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
        .stat-btn, .print-btn { background: #555; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; }
        .print-btn { background: #333; }

        /* --- [v8.0 í•µì‹¬] Grid ì‹œìŠ¤í…œìœ¼ë¡œ ë ˆì´ì•„ì›ƒ ì™„ì „ ì¬êµ¬ì¶• --- */
        .timeline-headers { 
            display: grid; 
            grid-template-columns: 1fr 1fr; /* ì •í™•íˆ ë°˜ë°˜ ë‚˜ëˆ„ê¸° */
            max-width: 1000px; 
            width: 100%;
            margin: 0 auto; 
            padding-bottom: 15px;
        }
        
        /* ì™¼ìª½ ì¹¸: ë‚´ìš©ë¬¼ì„ ì˜¤ë¥¸ìª½ ë(end)ìœ¼ë¡œ ì •ë ¬ */
        .header-col.left { 
            justify-self: end;
            display: flex;
            justify-content: flex-end;
            padding-right: 50px; /* íƒ€ì„ë¼ì¸ ì¹´ë“œ ì—¬ë°±ê³¼ ì¼ì¹˜ */
            width: 100%;
        }
        
        /* ì˜¤ë¥¸ìª½ ì¹¸: ë‚´ìš©ë¬¼ì„ ì™¼ìª½ ë(start)ìœ¼ë¡œ ì •ë ¬ */
        .header-col.right { 
            justify-self: start;
            display: flex;
            justify-content: flex-start;
            padding-left: 50px; /* íƒ€ì„ë¼ì¸ ì¹´ë“œ ì—¬ë°±ê³¼ ì¼ì¹˜ */
            width: 100%;
        }
        
        .header-badge { 
            display: inline-block; 
            padding: 12px 0; 
            width: 160px; /* ë„ˆë¹„ ê³ ì • */
            border-radius: 15px; 
            font-weight: bold; 
            font-size: 1.2rem; 
            color: #333; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            border: 1px solid rgba(0,0,0,0.05); 
            text-align: center; 
            background-color: #fff;
        }

        /* --- íƒ€ì„ë¼ì¸ ë³¸ë¬¸ --- */
        .timeline { position: relative; max-width: 1000px; margin: 0 auto; padding-bottom: 80px; padding-top: 20px; }
        .timeline::after { content: ''; position: absolute; width: 4px; background-color: var(--line-color); top: 0; bottom: 0; left: 50%; margin-left: -2px; z-index: 0; }
        .container { padding: 10px 50px; position: relative; width: 50%; }
        .left { left: 0; text-align: right; } .right { left: 50%; text-align: left; }
        
        .content { padding: 15px; position: relative; transition: transform 0.2s; border-radius: 8px; border: 1px solid rgba(0,0,0,0.05); box-shadow: 2px 2px 5px rgba(0,0,0,0.05); background: white; text-align: left; }
        .left .content { text-align: right; }
        .content:hover { transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 10; }
        
        .year-bubble { position: absolute; width: 50px; height: 50px; background-color: white; border: 3px solid var(--line-color); border-radius: 50%; z-index: 10; text-align: center; line-height: 50px; font-weight: bold; font-size: 14px; color: var(--line-color); top: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .year-bubble:hover { background-color: var(--line-color); color: white; transform: scale(1.1); }
        .left .year-bubble { right: -25px; } .right .year-bubble { left: -25px; }
        
        .minor-row { width: 100%; height: 20px; position: relative; margin: 5px 0; }
        .minor-dot { position: absolute; left: 50%; margin-left: -6px; width: 12px; height: 12px; background-color: white; border: 2px solid var(--dot-color); border-radius: 50%; cursor: pointer; z-index: 5; transition: all 0.2s; }
        .minor-dot:hover { background-color: var(--edit-color); border-color: var(--edit-color); transform: scale(1.5); }
        .minor-dot::before { content: attr(data-tooltip); position: absolute; top: -30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
        .minor-dot:hover::before { opacity: 1; }

        .thumb-img { max-width: 80px; max-height: 80px; display: block; margin: 5px; border: 1px solid #ddd; padding: 2px; background: #fff; }
        .left .thumb-img { float: left; margin-right: 15px; } .right .thumb-img { float: right; margin-left: 15px; }
        .era-tag { font-size: 0.8em; color: #666; display: block; margin-bottom: 2px;}
        .title-text { font-size: 1.3em; font-weight: bold; cursor: pointer; color: #000; border-bottom: 1px dashed #bbb; }
        .title-text:hover { color: var(--line-color); border-bottom: 1px solid var(--line-color); }
        .clearfix::after { content: ""; clear: both; display: table; }
        .action-btns { margin-top: 5px; font-size: 0.8rem; display: none; }
        .btn-text { cursor: pointer; text-decoration: underline; margin-left: 8px; }
        .btn-del { color: red; } .btn-edit { color: var(--edit-color); }
        .tag-container { margin-top: 5px; }
        .tag-badge { display: inline-block; font-size: 0.75rem; background: var(--tag-bg); color: var(--tag-text); padding: 2px 6px; border-radius: 4px; margin-right: 4px; cursor: pointer; }
        .tag-badge:hover { background: #dcebff; text-decoration: underline; }
        .wiki-link { color: #d63384; font-weight: bold; cursor: pointer; border-bottom: 1px dotted #d63384; }
        .wiki-link:hover { background-color: #ffeef5; }
        a:not(.img-card) { color: var(--link-color); text-decoration: none; font-weight: bold; }
        a:not(.img-card):hover { text-decoration: underline; background-color: #eee; border-radius: 3px;}

        /* --- ëª¨ë°”ì¼ ìµœì í™” --- */
        @media (max-width: 768px) {
            .thumb-img, .tag-container, .content small, .action-btns { display: none !important; }
            .content { padding: 10px 15px; min-height: auto; display: flex; flex-direction: column; justify-content: center; }
            .title-text { font-size: 1.15rem; margin-bottom: 0; border-bottom: none; line-height: 1.3; }
            .era-tag { font-size: 0.85rem; margin-bottom: 3px; color: #666; font-weight: bold; }
            
            /* ëª¨ë°”ì¼ í—¤ë”: ê½‰ ì°¨ê²Œ */
            .header-badge { width: 90%; padding: 10px 0; font-size: 1rem; }
            /* ëª¨ë°”ì¼ì€ ì •ë ¬ í•´ì œ */
            .header-col.left { justify-content: center; padding-right: 5px;}
            .header-col.right { justify-content: center; padding-left: 5px;}
            
            .container { padding: 10px 30px; } 
            .left .content { align-items: flex-end; text-align: right; }
            .right .content { align-items: flex-start; text-align: left; }
        }

        /* --- ê´€ë¦¬ì íŒ¨ë„ --- */
        .admin-btn { position: fixed; top: 20px; right: 20px; padding: 8px 12px; background: #333; color: white; border: none; cursor: pointer; z-index: 200; border-radius: 5px; display: none; }
        .login-trigger { position: fixed; bottom: 10px; right: 10px; opacity: 0.3; font-size: 12px; cursor: pointer; z-index: 200;}
        
        #adminPanel { display: none; position: fixed; top: 60px; right: 20px; width: 500px; background: white; border: 2px solid #333; padding: 25px; z-index: 200; box-shadow: 0 5px 25px rgba(0,0,0,0.3); max-height: 90vh; overflow-y: auto; font-family: sans-serif; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-weight: bold; font-size: 13px; margin-bottom: 5px;}
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; font-size: 14px; }
        textarea { resize: vertical; } input[type="color"] { padding: 0; height: 35px; cursor: pointer;}
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        .btn-save { background-color: var(--line-color); color: white; border: none; padding: 12px; flex: 1; cursor: pointer; font-weight: bold; font-size: 14px;}
        .btn-save.editing { background-color: var(--edit-color); }
        .btn-reset { background-color: #666; color: white; border: none; padding: 12px; cursor: pointer;}
        .config-section { background: #eef; padding: 10px; border-radius: 5px; margin-bottom: 15px; border: 1px solid #ccd; }
        .config-toggle { width: 100%; text-align: left; background: none; border: none; cursor: pointer; font-weight: bold; padding: 0; }
        .syntax-guide { font-size: 11px; color: #555; background: #f8f9fa; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 5px; line-height: 1.5; letter-spacing: -0.5px; }
        .syntax-guide code { background: #fff; border: 1px solid #ccc; padding: 1px 4px; border-radius: 3px; color: #d63384; font-family: monospace; font-weight: bold; }
        .pinyin-btn { background-color: #28a745; color: white; border: none; padding: 3px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-left: 10px; }
        .pinyin-btn:hover { background-color: #218838; }

        /* --- ëª¨ë‹¬ --- */
        .modal { display: none; position: fixed; z-index: 200; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: #fff; margin: 3% auto; padding: 30px; border: 1px solid #888; width: 85%; max-width: 800px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto; position: relative; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .back-btn { display: none; float: left; background: #eee; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-weight: bold; color: #333; }
        .back-btn:hover { background: #ddd; }
        .stat-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem;}
        .stat-table th, .stat-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .stat-table th { background-color: #f2f2f2; font-weight: bold; }
        #contextModal .modal-content { max-width: 600px; background: #fdfdfd; }
        .ctx-list { list-style: none; padding: 0; margin-top: 20px; }
        .ctx-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; }
        .ctx-item:hover { background: #f0f0f0; }
        .ctx-item.current { background: #fff0f0; border-left: 4px solid var(--line-color); }
        .ctx-item.minor .ctx-name { color: #888; font-size: 0.95em; font-weight: normal; }
        .ctx-item.minor .ctx-year { color: #aaa; font-size: 1em; }
        .ctx-item.minor { opacity: 0.9; }
        .ctx-year { font-weight: bold; color: var(--line-color); width: 60px; font-size: 1.1em;}
        .ctx-info { flex: 1; }
        .ctx-name { font-weight: bold; font-size: 1.1em; color: #333; }
        .ctx-desc { font-size: 0.85em; color: #666; display: block;}
        .img-card { display: block; margin: 15px auto; text-align: center; border: 1px solid #ddd; padding: 5px; background: #fff; max-width: 90%; text-decoration: none !important; color: inherit !important; }
        .img-card:hover { transform: scale(1.02); }
        .img-card img { max-width: 100%; display: block; margin: 0 auto; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; margin: 15px 0; background: #000; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        details.outer-details { margin-bottom: 10px; border: 1px solid #eee; }
        summary.outer-summary { padding: 10px; cursor: pointer; background: #f9f9f9; font-weight: bold; list-style: none; }
        summary.outer-summary::before { content: 'ğŸ“œ '; }
        .poem-body { padding: 15px; white-space: pre-wrap; line-height: 2.2; color: #444; border-top: 1px solid #eee; }
        .hanja-text { font-size: 1.2rem; color: #222; margin-bottom: 5px; font-family: 'KoPub Batang', serif; }
        details.inner-details { border-top: 1px dashed #ddd; padding-top: 10px; margin-top: 10px; line-height: 1.6;}
        summary.inner-summary { font-size: 0.9rem; color: #666; cursor: pointer; list-style: none;}
        summary.inner-summary::before { content: 'ğŸ”½ '; }
        .simp-btn, .tts-btn { font-size: 0.8rem; background: #fff0f5; color: #d63384; border: 1px solid #d63384; border-radius: 3px; cursor: pointer; padding: 2px 5px; margin-top: 5px; display: inline-block; margin-right: 5px;}
        .simp-btn:hover, .tts-btn:hover { background: #d63384; color: white; }
        .tts-btn { background: #e6f7ff; color: #0056b3; border-color: #0056b3; }
        .tts-btn:hover { background: #0056b3; color: white; }
        .simplified-box { display: none; font-family: 'Noto Serif SC', serif; color: #555; background: #f9f9f9; padding: 15px; border-radius: 5px; margin-top: 10px; border-left: 4px solid #d63384; line-height: 1.8; }
        ruby { display: inline-block; text-align: center; margin: 0 2px; }
        rt { font-size: 0.6em; color: #777; font-family: sans-serif; display: block; line-height: 1.2; user-select: none; }
        .qtfm-btn { display: inline-block; background-color: #E60026; color: white; padding: 5px 12px; border-radius: 20px; text-decoration: none; font-size: 0.9rem; font-weight: bold; margin-top: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: transform 0.2s; }
        .qtfm-btn:hover { transform: scale(1.05); background-color: #cc0022; text-decoration: none; color: white; }

        /* ë°”ë‹¥ê¸€ */
        footer { text-align: center; padding: 20px; border-top: 1px solid #ddd; color: #888; font-size: 0.9rem; font-family: 'Noto Serif KR', serif; background-color: #fff0f0; }

        @media print {
            .admin-btn, .search-bar, .action-btns, .config-section, .btn-group, .help-trigger, .modal, .simp-btn, .pinyin-btn, .tts-btn, .login-trigger { display: none !important; }
            #stickyHeader { position: static; box-shadow: none; }
            body { background: white !important; color: black; padding-top: 0 !important; }
            .content { border: 1px solid #ccc; box-shadow: none; break-inside: avoid; }
            .timeline::after { background-color: #ccc; }
            .year-bubble { border-color: #333; color: #333; }
        }
    </style>
</head>
<body>
    <div id="stickyHeader">
        <header>
            <h1 id="pageTitle">ë‚˜ë§Œì˜ ì—­ì‚¬ ì—°í‘œ</h1>
            <p id="pageDesc" class="page-desc">ë¡œë”© ì¤‘...</p>
            <div class="search-bar">
                <input type="text" id="searchInput" class="search-input" placeholder="ì´ë¦„, ë‚´ìš©, íƒœê·¸ ê²€ìƒ‰..." onkeyup="filterData()">
                <select id="eraFilter" class="filter-select" onchange="filterData()"> <option value="all">ëª¨ë“  ì‹œëŒ€</option> </select>
                <button class="stat-btn" onclick="openStatModal()">ğŸ“Š í†µê³„</button>
                <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
            </div>
        </header>
        
        <div class="timeline-headers">
            <div class="header-col left"><span class="header-badge" id="badgeLeft">Label Left</span></div>
            <div class="header-col right"><span class="header-badge" id="badgeRight">Label Right</span></div>
        </div>
    </div>

    <button id="adminToggle" class="admin-btn" onclick="toggleAdmin()">âš™ï¸ ê´€ë¦¬/ì„¤ì •</button>

    <div id="adminPanel">
        <div class="config-section">
            <button class="config-toggle" onclick="toggleConfig()">ğŸ› ï¸ ë””ìì¸ ë° ì„¤ì • (í¼ì¹˜ê¸°)</button>
            <div id="configForm" style="display:none; margin-top:10px;">
                <div class="form-group"><label>ë©”ì¸ ì œëª©</label> <input type="text" id="cfgTitle"></div>
                <div class="form-group"><label>ì•ˆë‚´ ë¬¸êµ¬</label> <textarea id="cfgDesc" rows="2"></textarea></div>
                <div class="form-group"><label>ë°”ë‹¥ê¸€(Copyright) ë‚´ìš©</label> <input type="text" id="cfgCopyright" placeholder="ì˜ˆ: Copyright Â© 2026. All rights reserved."></div>
                <div class="form-group" style="display:flex; gap:5px;">
                    <div style="flex:1;"><label>ì™¼ìª½ ì´ë¦„</label><input type="text" id="cfgLabelLeft"></div>
                    <div style="flex:1;"><label>ì˜¤ë¥¸ìª½ ì´ë¦„</label><input type="text" id="cfgLabelRight"></div>
                </div>
                <div class="form-group"><label>ë°°ê²½ìƒ‰</label> <input type="color" id="cfgBgColor" style="width:100%;"></div>
                <div class="form-group"><label>ë°°ê²½ ì´ë¯¸ì§€</label> <input type="text" id="cfgBgImage"></div>
                <div class="form-group"><label>ë°˜ë³µ</label> <select id="cfgBgRepeat"><option value="repeat">ë°˜ë³µ</option><option value="cover">ê½‰ ì±„ìš°ê¸°</option></select></div>
                <div class="form-group" style="display:flex; gap:5px;">
                    <div style="flex:1;"><label>ì¢Œì¸¡ ìƒ‰</label><input type="color" id="cfgLeftColor" style="width:100%;"></div>
                    <div style="flex:1;"><label>ìš°ì¸¡ ìƒ‰</label><input type="color" id="cfgRightColor" style="width:100%;"></div>
                </div>
                <button class="btn-save" onclick="saveConfig()">ì„¤ì • ì €ì¥</button>
            </div>
        </div>
        <h3 id="formTitle" style="margin-top:20px; border-top:2px solid #333; padding-top:10px;">ë°ì´í„° ì…ë ¥</h3>
        <div class="form-group" style="background:#fff3cd; padding:10px; border-radius:5px; border:1px solid #ffeeba; display:flex; gap:10px;">
            <div style="flex:1;"><label>ğŸ¨ ê°•ì¡°ìƒ‰</label><input type="color" id="inCardColor" value="#ffffff" style="width:100%;"></div>
            <div style="flex:0 0 auto;"><button type="button" onclick="document.getElementById('inCardColor').value = '';" style="font-size:11px;">ê¸°ë³¸ê°’</button></div>
        </div>
        <div class="form-group" style="background:#f0f8ff; padding:10px; border-radius:5px; border:1px solid #cceeff;">
            <label style="margin-bottom:0;"><input type="checkbox" id="inShow" checked> <strong>í¬ê²Œ ë³´ì´ê¸°</strong></label>
        </div>
        <div class="form-group"><label>ìœ„ì¹˜</label> <select id="inType" onchange="updateFormUI()"><option value="poet" id="optLeft">ì™¼ìª½</option><option value="history" id="optRight">ì˜¤ë¥¸ìª½</option></select></div>
        <div class="form-group"><label>ì—°ë„ / ì‹œëŒ€</label><div style="display:flex; gap:5px;"><input type="number" id="inYear" placeholder="ì—°ë„" style="flex:1;"><input type="text" id="inEra" placeholder="ì‹œëŒ€" style="flex:1;"></div></div>
        <div class="form-group"><label>ì œëª©</label> <input type="text" id="inName"></div>
        <div class="form-group"><label>íƒœê·¸ (ì‰¼í‘œ êµ¬ë¶„)</label> <input type="text" id="inTags" placeholder="ì˜ˆ: ì „ìŸ, ì´ë³„, ìœ ë°°"></div>
        <div class="form-group"><label>ìš”ì•½ (4ì¤„)</label> <textarea id="inDesc" rows="4"></textarea></div>
        <div class="form-group"><label>ì´ë¯¸ì§€</label> <input type="text" id="inImg"></div>
        <div class="form-group">
            <label id="detailLabel" style="display:inline-block; margin-bottom:5px;">ìƒì„¸ ë‚´ìš©</label>
            <button type="button" class="pinyin-btn" onclick="autoPinyin()">ğŸ”  ë³‘ìŒ ìë™ ì…íˆê¸°</button>
            <div class="syntax-guide"><code>[ê¸€ì](ì£¼ì†Œ)</code> (ë§í¬) &nbsp; <code>{{ì´ë¯¸ì§€|ì£¼ì†Œ|ì„¤ëª…}}</code> &nbsp; <code>[[ë‚´ë¶€ë§í¬]]</code><br><code>ì œëª© | ë‚´ìš©</code> (ì²«ì¤„) &nbsp; <code>---</code> (í•´ì„¤ìˆ¨ê¹€) &nbsp; <code>===</code> (êµ¬ë¶„)<br><code>+++</code> (ê°„ì²´ì êµ¬ë¶„) &nbsp; <code>í•œì(pinyin)</code> (ë³‘ìŒí‘œì‹œ)</div>
            <textarea id="inContent" rows="15"></textarea>
        </div>
        <div class="btn-group"><button id="btnSave" class="btn-save" onclick="saveData()">ì €ì¥</button><button class="btn-reset" onclick="clearForm()">ì·¨ì†Œ</button></div>
        <hr>
        <div class="btn-group"><button class="btn-download" onclick="exportData()">ğŸ’¾ DB ë‹¤ìš´ë¡œë“œ (ì—…ë¡œë“œìš©)</button><input type="file" id="fileInput" onchange="importData(this)" style="display:none;"><button class="btn-reset" style="width:100%;" onclick="document.getElementById('fileInput').click()">ğŸ“‚ DB ë¶ˆëŸ¬ì˜¤ê¸°</button></div>
        <button class="btn-reset" style="width:100%; background:darkred; margin-top:5px;" onclick="resetAllData()">âš ï¸ ë¡œì»¬ ì´ˆê¸°í™”</button>
    </div>
    
    <div class="timeline" id="timeline-root"></div>
    
    <footer id="pageFooter"></footer>
    
    <div class="login-trigger" onclick="adminLogin()">Admin</div>

    <div id="detailModal" class="modal">
        <div class="modal-content"><button id="backBtn" class="back-btn" onclick="goBack()">â¬… ë’¤ë¡œ</button><span class="close" onclick="closeModal('detailModal')">&times;</span><div style="clear:both;"></div><img id="mImg" class="img-card" style="display:none; max-width:200px;"><h2 id="mName" style="text-align:center;"></h2><div id="mTags" style="text-align:center; margin-bottom:10px;"></div><div id="mDesc" style="background:#f5f5f5; padding:15px; border-radius:5px; white-space: pre-wrap;"></div><hr><div id="mContentArea"></div></div>
    </div>
    <div id="contextModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('contextModal')">&times;</span><h3 style="text-align:center; border-bottom:2px solid #8B0000; padding-bottom:10px;">âŒ› <span id="ctxTargetYear"></span>ë…„ ì „í›„ ê¸°ë¡</h3><ul id="ctxList" class="ctx-list"></ul></div></div>
    <div id="statModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('statModal')">&times;</span><h3>ğŸ“Š ë°ì´í„° í†µê³„</h3><div id="statContent"></div></div></div>

    <script>
        const defaultConfig = { title: "ë‹¹ë‚˜ë¼ ì—­ì‚¬ì™€ ì‹œì¸ ì—°í‘œ", desc: "ë‚˜ë§Œì˜ ì—­ì‚¬ ë°ì´í„°ë² ì´ìŠ¤", leftLabel: "ì‹œì¸ / ì‘í’ˆ", rightLabel: "ì—­ì‚¬ / ì‚¬ê±´", bgColor: "#fff0f0", bgImage: "", bgRepeat: "repeat", leftCardColor: "#ffffff", rightCardColor: "#ffffff", copyright: "" };
        let db=[], config={}, editingId=null, modalHistory=[], currentOpenId=null;
        let isAdmin = false; 

        async function init() {
            try {
                try {
                    const response = await fetch('database.json');
                    if (response.ok) {
                        const jsonData = await response.json();
                        db = jsonData.data || [];
                        config = jsonData.config || defaultConfig;
                    } else { throw new Error("No external DB"); }
                } catch (err) {
                    const savedData = localStorage.getItem('tangTimelineDB'); db = savedData ? JSON.parse(savedData) : [];
                    const savedConfig = localStorage.getItem('tangTimelineConfig'); config = savedConfig ? JSON.parse(savedConfig) : {...defaultConfig};
                }
                applyConfigUI(); populateEraFilter(); render();
                document.getElementById('pageDesc').innerText = config.desc;
                document.getElementById('adminToggle').style.display = 'none';
                
                // [NEW] ì°½ í¬ê¸° ë°”ë€” ë•Œë§ˆë‹¤ ìƒë‹¨ ì—¬ë°± ì¬ê³„ì‚°
                adjustPadding();
                window.addEventListener('resize', adjustPadding);

            } catch (e) { alert("ì´ˆê¸°í™” ì˜¤ë¥˜: " + e.message); }
        }

        // [NEW] ìƒë‹¨ í—¤ë” ë†’ì´ì— ë§ì¶° ë³¸ë¬¸ ì—¬ë°± ìë™ ì¡°ì ˆ
        function adjustPadding() {
            const headerHeight = document.getElementById('stickyHeader').offsetHeight;
            document.getElementById('timeline-root').style.paddingTop = '20px'; // stickyë¼ íŒ¨ë”© êµ³ì´ ì•ˆë°€ì–´ë„ ë¨, ë¯¸ì„¸ì¡°ì •ë§Œ
        }

        // [ë³´ì•ˆ ê°•í™” ë²„ì „] ê´€ë¦¬ì ë¡œê·¸ì¸
        async function adminLogin() {
            if (isAdmin) return;
            const password = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (!password) return;

            const msgBuffer = new TextEncoder().encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

            const mySecret = "6eb20c53054a7218e6731761b7539d9e38f6f5e39e53c2d78e0edd732de650f2"; 

            if (hashHex === mySecret) {
                isAdmin = true;
                document.getElementById('adminToggle').style.display = 'block';
                alert("ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”!");
                render();
            } else {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
            }
        }

        // --- ë°ì´í„° ì €ì¥/ê´€ë¦¬ ---
        function saveToLocal() {
            db.sort((a, b) => a.year - b.year);
            localStorage.setItem('tangTimelineDB', JSON.stringify(db));
        }

        function exportData() {
            const exportObj = { data: db, config: config };
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj));
            const node = document.createElement('a'); node.href = dataStr; node.download = "database.json";
            document.body.appendChild(node); node.click(); node.remove();
        }

        function importData(input) {
            const file = input.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loaded = JSON.parse(e.target.result);
                    if(loaded.data) { db = loaded.data; config = loaded.config || defaultConfig; } 
                    else { if(Array.isArray(loaded)) db = loaded; }
                    localStorage.setItem('tangTimelineConfig', JSON.stringify(config));
                    saveToLocal(); applyConfigUI(); alert('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!');
                } catch(err) { alert('ì˜¤ë¥˜: ' + err.message); }
            }; reader.readAsText(file);
        }

        // --- ìŠ¤ë§ˆíŠ¸ ë³‘ìŒ ë³€í™˜ê¸° ---
        function autoPinyin() {
            const input = document.getElementById('inContent');
            const fullText = input.value;
            
            if (!fullText) { alert('ë³€í™˜í•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            if (typeof pinyinPro === 'undefined') { alert('ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'); return; }

            const { pinyin } = pinyinPro;
            const start = input.selectionStart;
            const end = input.selectionEnd;
            if (start !== end) {
                const selectedText = fullText.substring(start, end);
                const converted = convertToPinyinString(selectedText, pinyin);
                input.setRangeText(converted);
                return;
            }

            const parts = fullText.split('---');
            const poemPart = parts[0]; 
            const explPart = parts.slice(1).join('---'); 
            const plusSplit = poemPart.split('+++');
            let processedPoem = "";

            if (plusSplit.length > 1) {
                const prePlus = plusSplit[0];
                const targetText = plusSplit[1];
                const convertedTarget = convertToPinyinString(targetText, pinyin);
                processedPoem = prePlus + '+++' + convertedTarget;
            } else {
                processedPoem = convertToPinyinString(poemPart, pinyin);
            }

            let finalText = processedPoem;
            if (parts.length > 1) { finalText += '---' + explPart; }
            input.value = finalText;
        }

        function convertToPinyinString(str, pinyinFunc) {
            const result = pinyinFunc(str, { type: 'all', toneType: 'symbol', nonZh: 'consecutive' });
            return result.map(item => item.isZh ? `${item.origin}(${item.pinyin})` : item.origin).join('');
        }

        // --- ë Œë”ë§ (ê´€ë¦¬ì ëª¨ë“œ ë°˜ì˜) ---
        function render(query = "", eraFilter = "all") {
            const root = document.getElementById('timeline-root'); root.innerHTML = '';
            const filtered = db.filter(item => {
                const textMatch = item.name.toLowerCase().includes(query) || item.desc.toLowerCase().includes(query) || (item.tags && item.tags.join(" ").toLowerCase().includes(query));
                const eraMatch = eraFilter === 'all' || item.era === eraFilter;
                return textMatch && eraMatch;
            });
            filtered.forEach(item => {
                if (item.isShow) {
                    const div = document.createElement('div'); div.className = item.type === 'poet' ? 'container left' : 'container right';
                    const imgTag = item.img ? `<img src="${item.img}" class="thumb-img">` : '';
                    let cardBg = item.cardColor; if(!cardBg || cardBg === "#ffffff" || cardBg === "") cardBg = (item.type === 'poet' ? config.leftCardColor : config.rightCardColor) || "#ffffff";
                    let tagHtml = item.tags && item.tags.length > 0 ? '<div class="tag-container">' + item.tags.map(t => `<span class="tag-badge" onclick="searchTag('${t}')">#${t}</span>`).join('') + '</div>' : "";
                    
                    const btns = isAdmin ? `<div class="action-btns" style="display:block;"><span class="btn-text btn-edit" onclick="editItem(${item.id})">[ìˆ˜ì •]</span><span class="btn-text btn-del" onclick="deleteItem(${item.id})">[ì‚­ì œ]</span></div>` : '';

                    div.innerHTML = `<div class="year-bubble" onclick="openContextModal(${item.id})">${item.year}</div><div class="content clearfix" style="background-color:${cardBg};">${imgTag} <span class="era-tag">${item.era}</span><div class="title-text" onclick="openModal(${item.id})">${item.name}</div>${tagHtml} <small>${item.desc.substring(0, 30)}...</small>${btns}</div>`;
                    root.appendChild(div);
                } else {
                    const div = document.createElement('div'); div.className = 'minor-row';
                    div.innerHTML = `<div class="minor-dot" data-tooltip="${item.year} : ${item.name}" onclick="openModal(${item.id})"></div>`;
                    root.appendChild(div);
                }
            });
            
            // ë Œë”ë§ í›„ í—¤ë” ë†’ì´ê°€ ë°”ë€Œì—ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ íŒ¨ë”© ì¬ì¡°ì •
            setTimeout(adjustPadding, 100);
        }

        // --- ê¸°íƒ€ ê¸°ëŠ¥ë“¤ ---
        function populateEraFilter() {
            const eras = [...new Set(db.map(item => item.era).filter(e => e))].sort();
            const select = document.getElementById('eraFilter'); select.innerHTML = '<option value="all">ëª¨ë“  ì‹œëŒ€</option>';
            eras.forEach(era => { select.innerHTML += `<option value="${era}">${era}</option>`; });
        }
        function filterData() { render(document.getElementById('searchInput').value.toLowerCase(), document.getElementById('eraFilter').value); }
        
        function parseText(text, isPoetMode = false) {
            if (!text) return "";
            if (isPoetMode) { text = text.replace(/([\u2E80-\u2EFF\u31C0-\u31EF\u3200-\u32FF\u3400-\u4DBF\u4E00-\u9FBF\uF900-\uFAFF])\(([^)]+)\)/g, "<ruby>$1<rt>$2</rt></ruby>"); }
            text = text.replace(/\[\[(.+?)\]\]/g, '<span class="wiki-link" onclick="openModalByName(\'$1\')">$1</span>');
            text = text.replace(/\{\{(.+?)\s*\|\s*(.+?)\s*\|\s*(.+?)\}\}/g, '<a href="$2" target="_blank" class="img-card"><img src="$1" alt="$3"><span class="img-caption">$3</span></a>');
            text = text.replace(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|embed\/|v\/|shorts\/)|youtu\.be\/)([\w-]{11})(?:[&?][^"\s]*)?/g, '<div class="video-container"><iframe src="https://www.youtube.com/embed/$1" title="YouTube" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe></div>');
            text = text.replace(/(https?:\/\/www\.qtfm\.cn\S+)/g, '<a href="$1" target="_blank" class="qtfm-btn">ğŸ§ èœ»èœ“FM ë‚­ì†¡ ë“£ê¸°</a>');
            text = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">ğŸ”— $1</a>');
            return text;
        }

        function openModalByName(name) {
            if(currentOpenId !== null) { modalHistory.push(currentOpenId); document.getElementById('backBtn').style.display = 'block'; }
            const item = db.find(d => d.name.trim() === name.trim());
            if(item) openModal(item.id, true); else alert("ë§í¬ëœ ì¹´ë“œ '" + name + "'ì´(ê°€) ì—†ìŠµë‹ˆë‹¤.");
        }
        function goBack() { if(modalHistory.length > 0) { const prevId = modalHistory.pop(); if(modalHistory.length === 0) document.getElementById('backBtn').style.display = 'none'; openModal(prevId, true); } }
        function searchTag(tag) { document.getElementById('searchInput').value = tag; filterData(); }
        function toggleAdmin() { document.getElementById('adminPanel').style.display = document.getElementById('adminPanel').style.display === 'block' ? 'none' : 'block'; }
        function toggleConfig() { document.getElementById('configForm').style.display = document.getElementById('configForm').style.display === 'none' ? 'block' : 'none'; }
        function toggleSimplified(id) { const el = document.getElementById(id); el.style.display = el.style.display === 'none' ? 'block' : 'none'; }
        
        function applyConfigUI() {
            document.getElementById('pageTitle').innerText = config.title; document.getElementById('pageDesc').innerText = config.desc;
            document.title = config.title; 
            
            // Footer & Header & ë°°ê²½ ì—…ë°ì´íŠ¸
            document.getElementById('pageFooter').innerHTML = config.copyright || "";
            document.getElementById('cfgCopyright').value = config.copyright || "";

            const badgeLeft = document.getElementById('badgeLeft');
            const badgeRight = document.getElementById('badgeRight');
            badgeLeft.innerText = config.leftLabel;
            badgeRight.innerText = config.rightLabel;
            badgeLeft.style.backgroundColor = config.leftCardColor || "#ffffff";
            badgeRight.style.backgroundColor = config.rightCardColor || "#ffffff";

            document.getElementById('cfgTitle').value = config.title; document.getElementById('cfgDesc').value = config.desc;
            document.getElementById('cfgLabelLeft').value = config.leftLabel; document.getElementById('cfgLabelRight').value = config.rightLabel;
            document.getElementById('cfgBgColor').value = config.bgColor || "#fff0f0"; document.getElementById('cfgBgImage').value = config.bgImage || "";
            document.getElementById('cfgLeftColor').value = config.leftCardColor || "#ffffff"; document.getElementById('cfgRightColor').value = config.rightCardColor || "#ffffff";
            document.getElementById('optLeft').innerText = "ì™¼ìª½: " + config.leftLabel; document.getElementById('optRight').innerText = "ì˜¤ë¥¸ìª½: " + config.rightLabel;
            
            // ë°°ê²½ìƒ‰ ì ìš© (Sticky í—¤ë” í¬í•¨)
            document.body.style.backgroundColor = config.bgColor || "#fff0f0";
            document.getElementById('stickyHeader').style.backgroundColor = config.bgColor || "#fff0f0";
            document.getElementById('pageFooter').style.backgroundColor = config.bgColor || "#fff0f0";

            if(config.bgImage) {
                document.body.style.backgroundImage = `url('${config.bgImage}')`;
                document.body.style.backgroundSize = config.bgRepeat === 'cover' ? 'cover' : 'auto';
                document.body.style.backgroundRepeat = config.bgRepeat === 'cover' ? 'no-repeat' : 'repeat';
            } else {
                document.body.style.backgroundImage = 'none';
            }
            updateFormUI();
            
            // ì„¤ì • ì ìš© í›„ íŒ¨ë”© ì¬ì¡°ì •
            setTimeout(adjustPadding, 100);
        }
        function saveConfig() {
            config.title = document.getElementById('cfgTitle').value; config.desc = document.getElementById('cfgDesc').value;
            config.copyright = document.getElementById('cfgCopyright').value;

            config.leftLabel = document.getElementById('cfgLabelLeft').value; config.rightLabel = document.getElementById('cfgLabelRight').value;
            config.bgColor = document.getElementById('cfgBgColor').value; config.bgImage = document.getElementById('cfgBgImage').value;
            config.bgRepeat = document.getElementById('cfgBgRepeat').value; config.leftCardColor = document.getElementById('cfgLeftColor').value;
            config.rightCardColor = document.getElementById('cfgRightColor').value;
            localStorage.setItem('tangTimelineConfig', JSON.stringify(config)); applyConfigUI(); render(); alert('ì €ì¥ë¨');
        }
        function updateFormUI() {}
        function editItem(id) {
            const item = db.find(d => d.id === id); if (!item) return;
            document.getElementById('adminPanel').style.display = 'block'; document.getElementById('inShow').checked = item.isShow;
            document.getElementById('inType').value = item.type; document.getElementById('inYear').value = item.year; document.getElementById('inEra').value = item.era;
            document.getElementById('inName').value = item.name; document.getElementById('inTags').value = item.tags ? item.tags.join(", ") : "";
            document.getElementById('inDesc').value = item.desc; document.getElementById('inImg').value = item.img || "";
            document.getElementById('inCardColor').value = item.cardColor || "#ffffff";
            const contentBox = document.getElementById('inContent');
            if (item.type === 'poet' && item.poems) contentBox.value = item.poems.map(p => `${p.title}|${p.content}`).join('\n\n===\n\n'); else contentBox.value = item.historyDetail || "";
            editingId = id; document.getElementById('btnSave').innerText = "ìˆ˜ì • ì™„ë£Œ"; window.scrollTo(0, 0);
        }
        function saveData() {
            const isShow = document.getElementById('inShow').checked; const type = document.getElementById('inType').value;
            const year = document.getElementById('inYear').value; const era = document.getElementById('inEra').value;
            const name = document.getElementById('inName').value; const tags = document.getElementById('inTags').value.split(',').map(t=>t.trim()).filter(t=>t);
            const desc = document.getElementById('inDesc').value; const img = document.getElementById('inImg').value;
            const cardColor = document.getElementById('inCardColor').value; const rawContent = document.getElementById('inContent').value;
            if (!year || !name) { alert('í•„ìˆ˜ í•­ëª© ëˆ„ë½'); return; }
            let poems = []; let historyDetail = "";
            if (type === 'poet' && rawContent.trim()) { const blocks = rawContent.split('==='); poems = blocks.map(b => { const idx = b.indexOf('|'); return idx !== -1 ? { title: b.substring(0, idx).trim(), content: b.substring(idx + 1).trim() } : null; }).filter(p => p); } else { historyDetail = rawContent.trim(); }
            const newData = { id: editingId || Date.now(), year, era, type, name, tags, desc, img, isShow, cardColor, poems, historyDetail };
            if (editingId) { const idx = db.findIndex(d => d.id === editingId); if (idx !== -1) db[idx] = newData; } else { db.push(newData); }
            saveToLocal(); render(); populateEraFilter(); clearForm();
        }
        function clearForm() {
            document.getElementById('inYear').value = ''; document.getElementById('inName').value = '';
            document.getElementById('inTags').value = ''; document.getElementById('inDesc').value = '';
            document.getElementById('inImg').value = ''; document.getElementById('inContent').value = '';
            document.getElementById('inShow').checked = true; document.getElementById('inCardColor').value = "#ffffff";
            editingId = null; document.getElementById('btnSave').innerText = "ì €ì¥";
        }
        function deleteItem(id) { if(confirm('ì‚­ì œ?')) { db = db.filter(i => i.id !== id); saveToLocal(); render(); populateEraFilter(); } }
        function resetAllData() { if(confirm('ì „ì²´ ì‚­ì œ?')) { localStorage.removeItem('tangTimelineDB'); location.reload(); } }

        function openModal(id, keepHistory = false) {
            const item = db.find(d => d.id === id); if (!item) return;
            if (!keepHistory) { modalHistory = []; document.getElementById('backBtn').style.display = 'none'; }
            currentOpenId = id;
            const editBtnHtml = isAdmin ? `<div style="text-align:right; margin-bottom:10px;"><span class="btn-text btn-edit" onclick="editItem(${item.id}); closeModal('detailModal');">[ìˆ˜ì •]</span></div>` : '';
            document.getElementById('mName').innerHTML = `${item.name} <span style='font-size:0.7em; color:#888;'>(${item.year})</span>`;
            document.getElementById('mDesc').innerHTML = editBtnHtml + parseText(item.desc, false);
            const tagsHtml = item.tags ? item.tags.map(t => `<span class="tag-badge">#${t}</span>`).join('') : "";
            document.getElementById('mTags').innerHTML = tagsHtml;
            const mImg = document.getElementById('mImg');
            if(item.img) { mImg.src = item.img; mImg.style.display = 'block'; } else { mImg.style.display = 'none'; }
            const area = document.getElementById('mContentArea'); area.innerHTML = '';
            if (item.type === 'poet' && item.poems) {
                item.poems.forEach((p, index) => {
                    const details = document.createElement('details'); details.className = 'outer-details';
                    const parts = p.content.split('---'); 
                    const mainAndSimp = parts[0].split('+++'); 
                    const traditionalRaw = mainAndSimp[0].trim();
                    const simplifiedRaw = mainAndSimp.length > 1 ? mainAndSimp[1].trim() : "";
                    const simpId = `simp_${item.id}_${index}`;
                    let body = `<div class="hanja-text">${parseText(traditionalRaw, true)}</div>`; 
                    if (simplifiedRaw) {
                        body += `<span class="simp-btn" onclick="toggleSimplified('${simpId}')">ğŸ‡¨ğŸ‡³ ê°„ì²´ì ë³´ê¸°</span><div id="${simpId}" class="simplified-box"><div style="margin-top:5px;">${parseText(simplifiedRaw, true)}</div></div>`;
                    }
                    if(parts.length > 1) { body += `<details class="inner-details"><summary class="inner-summary">[í•´ì„¤ ë³´ê¸°]</summary><div class="explain-text">${parseText(parts.slice(1).join('---'), false)}</div></details>`; }
                    details.innerHTML = `<summary class="outer-summary">${p.title}</summary><div class="poem-body">${body}</div>`;
                    area.appendChild(details);
                });
            } else if (item.historyDetail) { area.innerHTML = `<div class="poem-body">${parseText(item.historyDetail, false)}</div>`; }
            document.getElementById('detailModal').style.display = "block";
        }

        function openStatModal() {
            const total = db.length; const leftCount = db.filter(d=>d.type==='poet').length; const rightCount = db.filter(d=>d.type==='history').length;
            const eras = {}; db.forEach(d => { eras[d.era] = (eras[d.era] || 0) + 1; });
            let html = `<table class="stat-table"><tr><th>ì´ ë°ì´í„°</th><td>${total}ê°œ</td></tr><tr><th>${config.leftLabel}</th><td>${leftCount}ê°œ</td></tr><tr><th>${config.rightLabel}</th><td>${rightCount}ê°œ</td></tr><tr><th colspan="2" style="text-align:center;">ì‹œëŒ€ë³„ ë¶„í¬</th></tr>`;
            for (const [key, val] of Object.entries(eras)) { html += `<tr><th>${key}</th><td>${val}ê°œ</td></tr>`; }
            html += `</table>`;
            document.getElementById('statContent').innerHTML = html; document.getElementById('statModal').style.display = 'block';
        }
        function openContextModal(targetId) {
            const targetItem = db.find(d => d.id === targetId); if (!targetItem) return;
            const idx = db.findIndex(d => d.id === targetId);
            document.getElementById('ctxTargetYear').innerText = targetItem.year;
            const siblings = db.slice(Math.max(0, idx - 5), Math.min(db.length, idx + 6));
            const list = document.getElementById('ctxList'); list.innerHTML = '';
            siblings.forEach(item => {
                const li = document.createElement('li'); const isMinor = !item.isShow;
                li.className = `ctx-item ${item.id === targetId ? 'current' : ''} ${isMinor ? 'minor' : ''}`;
                li.onclick = () => { closeModal('contextModal'); openModal(item.id); };
                li.innerHTML = `<div class="ctx-year">${item.year}</div><div class="ctx-info"><div class="ctx-name">${item.name}</div><span class="ctx-desc">${item.desc.substring(0, 40)}...</span></div>`;
                list.appendChild(li);
            });
            document.getElementById('contextModal').style.display = "block";
        }
        function closeModal(id) { document.getElementById(id).style.display = "none"; }
        window.onclick = function(e) { if(e.target.classList.contains('modal')) e.target.style.display="none"; }
        
        init();
    </script>
</body>
</html>
